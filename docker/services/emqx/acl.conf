%% EMQX Access Control List Configuration
%% Format: {allow|deny, {user|client|ip|all}, subscribe|publish|pubsub, TopicPattern}

%% =============================================================================
%% Default Rules
%% =============================================================================

%% Allow all operations for superuser
{allow, {user, "admin"}, pubsub, ["#"]}.

%% =============================================================================
%% System Topics ($SYS)
%% =============================================================================

%% Deny publish to system topics for all users
{deny, all, publish, ["$SYS/#"]}.

%% Allow subscribe to system topics (monitoring)
{allow, all, subscribe, ["$SYS/#"]}.

%% =============================================================================
%% Device Twin Topics ($devices)
%% =============================================================================

%% Allow devices to access their own twin topics
{allow, all, pubsub, ["$devices/${clientid}/#"]}.

%% Allow admin to access all device twins
{allow, {user, "admin"}, pubsub, ["$devices/#"]}.

%% =============================================================================
%% Shared Subscriptions ($share)
%% =============================================================================

%% Allow shared subscriptions for load balancing
{allow, all, subscribe, ["$share/+/#"]}.

%% =============================================================================
%% Client-specific Topics
%% =============================================================================

%% Allow clients to publish/subscribe to their own topics
{allow, all, pubsub, ["devices/${clientid}/#"]}.
{allow, all, pubsub, ["clients/${clientid}/#"]}.

%% =============================================================================
%% User-specific Topics
%% =============================================================================

%% Allow users to publish/subscribe to their own topics
{allow, all, pubsub, ["users/${username}/#"]}.

%% =============================================================================
%% Public Topics
%% =============================================================================

%% Allow all users to subscribe to public topics
{allow, all, subscribe, ["public/#"]}.
{allow, all, subscribe, ["broadcast/#"]}.

%% Allow authenticated users to publish to public topics
{allow, {user, all}, publish, ["public/#"]}.

%% =============================================================================
%% Test Topics (for integration testing)
%% =============================================================================

%% Allow all operations on test topics
{allow, all, pubsub, ["test/#"]}.
{allow, all, pubsub, ["integration/#"]}.

%% =============================================================================
%% Telemetry Topics
%% =============================================================================

%% Allow devices to publish telemetry
{allow, all, publish, ["telemetry/#"]}.

%% Allow backend services to subscribe to telemetry
{allow, all, subscribe, ["telemetry/#"]}.

%% =============================================================================
%% Command Topics
%% =============================================================================

%% Allow devices to subscribe to their command topics
{allow, all, subscribe, ["commands/${clientid}/#"]}.

%% Allow admin to publish commands
{allow, {user, "admin"}, publish, ["commands/#"]}.

%% =============================================================================
%% Default Deny (catch-all for unlisted topics)
%% =============================================================================

%% Note: The authorization.no_match setting in emqx.conf determines default behavior
%% Set to 'allow' for dev/test, 'deny' for production
